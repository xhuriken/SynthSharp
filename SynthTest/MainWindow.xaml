<Window x:Class="SynthTest.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Modular Synth Architect" Height="600" Width="1000" Background="#1E1E1E"
        MouseLeftButtonDown="OnWindowMouseDown"
        MouseLeftButtonUp="OnWindowMouseUp"
        MouseMove="OnWindowMouseMove">

    <Window.Resources>
        <ContextMenu x:Key="RackContextMenu">
            <MenuItem Header="Add VCO" Click="OnAddVcoClick"/>
            <MenuItem Header="Add Mixer" Click="OnAddMixerClick"/>
        </ContextMenu>
    </Window.Resources>

    <Grid Background="Transparent" ContextMenu="{StaticResource RackContextMenu}">

        <ItemsControl ItemsSource="{Binding Rack.Modules}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal"/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
        </ItemsControl>

        <ItemsControl x:Name="CableLayer" ItemsSource="{Binding Rack.Cables}" IsHitTestVisible="False">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <Canvas/>
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Line X1="{Binding StartPoint.X}" 
                            Y1="{Binding StartPoint.Y}"
                            X2="{Binding EndPoint.X}" 
                            Y2="{Binding EndPoint.Y}"
                            Stroke="Red" 
                            StrokeThickness="3"/>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>

        <Canvas x:Name="DragLayer" IsHitTestVisible="False">
            <Line x:Name="DragLine" Stroke="White" StrokeThickness="2" StrokeDashArray="2 2" Visibility="Collapsed"/>
        </Canvas>
    </Grid>
</Window>